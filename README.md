# SwiftData Migration Kit üß∞

[![Swift 5.9](https://img.shields.io/badge/Swift-5.9-orange.svg)](https://swift.org)
[![SwiftData](https://img.shields.io/badge/SwiftData-‚úì-blue.svg)](https://developer.apple.com/documentation/swiftdata)
[![License: MIT](https://img.shields.io/badge/License-MIT-lightgrey.svg)](https://opensource.org/licenses/MIT)

**–†–µ—à–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –º–∏–≥—Ä–∞—Ü–∏–π –≤ SwiftData** ‚Äî –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ Apple –Ω–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–ª–∞. –û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ –∂–µ—Å—Ç–∫–∏—Ö —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞—Ö –∏ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã—Ö –±–∞–≥–∞—Ö.

## üî• –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

‚úÖ –†–∞–±–æ—á–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è Xcode 16.3+  
‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –º–æ–¥–µ–ª–∏  
‚úÖ –û–±—Ö–æ–¥ –æ—à–∏–±–æ–∫ —Ç–∏–ø–∞ _"Cannot use staged migration with an unknown model version"_  
‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–ª–æ–∂–Ω—ã—Ö –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π –¥–∞–Ω–Ω—ã—Ö  

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞

–î–æ–±–∞–≤—å—Ç–µ –≤ –≤–∞—à `Package.swift`:

```swift
dependencies: [
    .package(url: "https://github.com/–í–ê–®_–ù–ò–ö/SwiftDataMigrationKit.git", from: "1.0.0")
]
```
## üîÑ –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î –≤ SwiftData
–û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–∏–Ω—Ü–∏–ø –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ **SwiftData** —Å—Ç–∞—Ä–∞–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Å—Ç–∏ –º–∏–≥—Ä–∞—Ü–∏—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –ü—Ä–∏–º–µ—Ä—ã:
#### 1. –ê–≤—Ç–æ–º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—è
```swift
// –ò—Å—Ö–æ–¥–Ω–∞—è –º–æ–¥–µ–ª—å
@Model
final class User {
    var name: String
    
    init(name: String) {
        self.name = name
    }
}

// –ù–æ–≤–∞—è –º–æ–¥–µ–ª—å
@Model
final class User {
    var name: String
    var details: String = ""
    
    init(name: String, details: String) {
        self.name = name
        self.details = details
    }
}
```
–î–∞–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ–¥–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
–ö–ª—é—á–µ–≤—ã–º –º–æ–º–µ–Ω—Ç–æ–º —è–≤–ª—è–µ—Ç—Å—è –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –ø–æ–ª–µ **details** –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:
```swift
var details: String = ""
```
–≠—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —è–≤–ª—è–µ—Ç—Å—è üí° **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º —É—Å–ª–æ–≤–∏–µ–º**. –ï—Å–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤—ã—á–∏—Å–ª—è–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, —Ç–æ –Ω—É–∂–Ω–∞ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏.
–ò —ç—Ç–æ –±—É–¥–µ—Ç —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–æ –≤ –ø—Ä–∏–º–µ—Ä–µ.
> üí° **–í–æ–∑–º–æ–∂–Ω–æ, –ø–æ–ª–µ–∑–Ω—ã–π –º–æ–º–µ–Ω—Ç**  
> –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –∏–∑–º–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª—å—é, –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º –ø—Ä–∏—Å–≤–æ–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ —Å—Ç—Ä–æ–∫–µ
> ```swift
> var details: String = ""
> ```
> –º–æ–∂–Ω–æ –±—É–¥–µ—Ç —É–±—Ä–∞—Ç—å. 

–¢–∞–∫ –∂–µ –≤–æ–∑–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ø–æ–ª—è:
```swift
// –ù–æ–≤–∞—è –º–æ–¥–µ–ª—å
@Model
final class User {
    var name: String
    var details: String?
    
    init(name: String, details: String) {
        self.name = name
        self.details = details
    }
}
```
–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ **SwiftData** –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —É—Å—Ç–∞–Ω–æ–≤–∏—Ç –≤–æ –≤—Å–µ—Ö –∑–∞–ø–∏—Å—è—Ö –Ω–æ–≤–æ–≥–æ –ø–æ–ª—è –∑–Ω–∞—á–µ–Ω–∏–µ **nil**

#### 2. –ê–≤—Ç–æ–º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—è
```swift
// –ò—Å—Ö–æ–¥–Ω–∞—è –º–æ–¥–µ–ª—å
@Model
final class User {
    var name: String
    
    init(name: String) {
        self.name = name
    }
}

// –ù–æ–≤–∞—è –º–æ–¥–µ–ª—å

```

## üéØ –ó–∞–¥–∞—á–∞

---
## Branch üåø main
–ù–∞—á–∞–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –≥–¥–µ –µ—Å—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:
```swift
@Model
final class User {
    var name: String
    var details: String
    var orders: [Order]?
    
    init(name: String, details: String, orders: [Order]? = nil) {
        self.name = name
        self.details = details
        self.orders = orders
    }
}

@Model
final class Order {
    var user: User?
    var title: String
    var timestamp: Date
    
    init(user: User? = nil, title: String, timestamp: Date) {
        self.user = user
        self.title = title
        self.timestamp = timestamp
    }
}
```
–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø—Ä–æ–≤–µ—Å—Ç–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –±—É–¥–µ–º –ø–æ–ª—É—á–∞—Ç—å –æ—à–∏–±–∫—É: **"Cannot use staged migration with an unknown model version"**
–¢—Ä–µ–±—É–µ—Ç—Å—è –æ–±—ë—Ä—Ç–∫–∞ –≤—Å–µ—Ö **@Models** –≤ –ø—Ä–æ—Ç–æ–∫–æ–ª **VersionedSchema**

---
## Branch üîß step1-add-version
–≠—Ç–æ—Ç —à–∞–≥ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è, –µ—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å –±–∞–∑–∞ —Å–æ —Å–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å. 
–ï—Å–ª–∏ –Ω–µ –∂–∞–ª–∫–æ –±–¥, —Ç–æ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ç–∫–µ, –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ —É–¥–∞–ª–∏–≤ —Ç—Ä–∏ —Ñ–∞–π–ª–∞ –∏–∑ –ø–∞–ø–∫–∏, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∫–∞–∑–∞–Ω–∞ –≤ –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

1. –î–æ–±–∞–≤–ª—è–µ–º –≤ –º–æ–¥–µ–ª–∏ —è–≤–Ω—ã–µ id-–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ—Ç–æ–º –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –æ—Å—Ç–∞–≤–∏—Ç—å.
   –ï—Å–ª–∏ –º–æ–¥–µ–ª—å –Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ —Å–≤—è–∑–∏ –æ–¥–∏–Ω-–º–Ω–æ–≥–æ, —Ç–æ —è–≤–Ω—ã–π id –º–æ–∂–Ω–æ –Ω–µ –¥–æ–±–∞–≤–ª—è—Ç—å (_–ø—Ä–æ–≤–µ—Ä–∏—Ç—å_)
